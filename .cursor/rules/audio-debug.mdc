---
description: 
globs: 
alwaysApply: false
---
# Audio Player Debugging

## Current Issue - COMPLEX iOS AUTOPLAY POLICIES
- Audio player not auto-playing on iPhone Safari (website, not PWA)
- **ROOT CAUSE**: iOS Safari has sophisticated autoplay policies with rate limiting
- iOS tracks "user interaction budget" and restricts autoplay after repeated attempts
- **FINDING**: "Sometimes works, sometimes doesn't" indicates rate limiting or budget exhaustion

## Debug Implementation
- Add debug paragraph above audio element in AudioPlayer component
- Show audio loading states, autoplay attempts, and errors
- Avoid prop drilling by keeping debug info internal to component
- Display current audio state and browser autoplay policies

## Technical Details
- iOS has strict autoplay policies requiring user interaction
- **KEY FINDING**: iOS stops at NETWORK_IDLE/HAVE_METADATA until manual play trigger
- After manual play: progresses to HAVE_ENOUGH_DATA and buffers entire file
- **NEW FINDING**: iOS has "interaction budget" that gets consumed with autoplay attempts
- Rate limiting prevents repeated autoplay even after successful loading trigger

## Solution Implementation - REVISED
- Detect when audio stops at metadata-loaded state on iOS
- Use user interaction capture to enable autoplay for session
- Implement fallback: auto-advance without autoplay on iOS
- Store user interaction state to enable subsequent autoplay attempts
- Work with iOS behavior rather than against it

## Next Steps
- Capture user interaction to enable autoplay budget
- Implement graceful fallback for iOS restrictions
- Consider session-based autoplay enablement after first user interaction
